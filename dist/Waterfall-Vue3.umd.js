!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["Waterfall-Vue3"]=t(e.Vue)}(this,(function(e){"use strict";var t=document.createElement("style");t.textContent=".vue-waterfall[data-v-606a03dc]{position:relative}.vue-waterfall-slot[data-v-2591e18a]{position:absolute;margin:0;padding:0;box-sizing:border-box}\n/*$vite$:1*/",document.head.appendChild(t);var n=(()=>{function e(e,n,i,o){let l=function(e,t,n,i){let a=0;for(let o=i,l=0;o<n.length&&l<=e;o++)l+=n[o].width*t/n[o].height,a++;return a}(e,n.lineGap,i,o),r=Math.max(l-1,1),d=t(e,n,i,o,l),u=function(e,t,n){return e.cost===1/0&&t.cost===1/0?t.width<n?t:e:t.cost>=e.cost?e:t}(t(e,n,i,o,r),d,e),s=u.height,f=u.width;return 1===u.count&&(f=Math.min(n.singleMaxWidth,e),s=i[o].height*f/i[o].width),{left:a(e,f,n.align),count:u.count,height:s}}function t(e,t,n,i,a){let o=0;for(let r=a-1;r>=0;r--){let e=n[i+r];o+=e.width*t.lineGap/e.height}let l=t.lineGap*e/o;if(l<=t.maxLineGap&&l>=t.minLineGap)return{cost:Math.abs(t.lineGap-l),count:a,width:e,height:l};{let n=o>e?t.minLineGap:t.maxLineGap;return{cost:1/0,count:a,width:o*n/t.lineGap,height:n}}}return{calculate:function(t,n,i,a){let o=t.$el.clientWidth,l=i.length,r=0,d=0;for(;d<l;){let t=e(o,n,i,d);for(let e,n,o=0,l=0;o<t.count;o++)e=i[d+o],n=a[d+o],n.top=r,n.left=t.left+l,n.width=e.width*t.height/e.height,n.height=t.height,l+=n.width;d+=t.count,r+=t.height}t.$el.style.height=r+"px"}}})(),i=(()=>({calculate:function(e,t,n,i){let r=e.$el.clientWidth,d=t.grow,u=d?function(e,t){let n=l(t);return{width:t.map((t=>e*t/n)),count:t.length,left:0}}(r,d):function(e,t){let n,i=e/t.lineGap;if(t.singleMaxWidth>=e)i=1,n=Math.max(e,t.minLineGap);else{let a=t.maxLineGap*~~i>=e,o=t.minLineGap*~~(i+1)<=e;a&&o?(i=Math.round(i),n=e/i):a?(i=~~i,n=e/i):o?(i=~~(i+1),n=e/i):(i=~~i,n=t.maxLineGap),1===i&&(n=Math.min(e,t.singleMaxWidth),n=Math.max(n,t.minLineGap))}return{width:o(n,i),count:i,left:a(e,n*i,t.align)}}(r,t),s=o(0,u.count);n.forEach(((e,n)=>{let a=s.reduce(((e,t,n)=>t<s[e]?n:e),0),o=u.width[a%u.count],r=i[n];r.top=s[a],r.left=u.left+(a?l(u.width.slice(0,a)):0),r.width=o,r.height=e.height*(t.fixedHeight?1:o/e.width),s[a]=s[a]+r.height})),e.$el.style.height=Math.max.apply(Math,s)+"px"}}))();function a(e,t,n){switch(n){case"right":return e-t;case"center":return(e-t)/2;default:return 0}}function o(e,t){let n="function"==typeof e?()=>e():()=>e,i=[];for(let a=0;a<t;a++)i[a]=n();return i}function l(e){return e.reduce(((e,t)=>e+t))}const r=(e,t)=>{const n=e.__vccOpts||e;for(const[i,a]of t)n[i]=a;return n},d="_wfMoveClass";return{Waterfall:r({__name:"Waterfall",props:{autoResize:{type:Boolean,default:!0},interval:{default:200,validator:e=>e>=0},align:{default:"left",validator:e=>~["left","right","center"].indexOf(e)},line:{default:"v",validator:e=>~["v","h"].indexOf(e)},lineGap:{required:!0,validator:e=>e>=0},minLineGap:{validator:e=>e>=0},maxLineGap:{validator:e=>e>=0},singleMaxWidth:{validator:e=>e>=0},grow:{validator:e=>e instanceof Array},fixedHeight:{default:!1},watch:{default:()=>({})}},setup(t){const a=t,o=e.ref(),l=e.getCurrentInstance(),r=e.ref([]),u=e.ref();function s(){var e;if(!l.proxy.$el)return;let t=l.proxy.$el.clientWidth,n=Array.from(null==(e=o.value)?void 0:e.children).map((e=>e.__vueParentComponent.exposed.getMeta()));n.sort(((e,t)=>e.order-t.order)),r.value=n.map((()=>({}))),h(l.proxy,n,r.value),setTimeout((()=>{var e;e=l.proxy.$el,t!==e.clientWidth&&h(l.proxy,n,r.value),l.proxy.$el.style.overflow="hidden",function(e,t){let n=t.filter((e=>e.moveClass)),i=f(n);!function(e,t){e.forEach(((e,n)=>{let i=t[n].node.style;t[n].vm._.exposed.rect.value=e;for(let t in e)i[t]=e[t]+"px"}))}(e,t);let a=f(n);n.forEach(((e,t)=>{e.node[d]=e.moveClass,function(e,t,n){let i=t.left-n.left,a=t.top-n.top,o=t.width/n.width,l=t.height/n.height;e.style.transform=e.style.WebkitTransform=`translate(${i}px,${a}px) scale(${o},${l})`,e.style.transitionDuration="0s"}(e.node,i[t],a[t])})),document.body.clientWidth,n.forEach((e=>{var t;!function(e,t){if(!function(e,t){return new RegExp("\\b"+t+"\\b").test(v(e,"class"))}(e,t)){let n=v(e,"class").trim();v(e,"class",(n+" "+t).trim())}}(e.node,e.moveClass),(t=e.node).style.transform=t.style.WebkitTransform="",t.style.transitionDuration=""}))}(r.value,n),y=!0,l.proxy.$emit("reflowed",l.proxy)}),0)}e.provide("reflow",s),e.watch([()=>a.align,()=>a.line,()=>a.lineGap,()=>a.minLineGap,()=>a.maxLineGap,()=>a.singleMaxWidth,()=>a.fixedHeight,()=>a.watch],(()=>{p()}),{immediate:!0}),e.watch(a.grow,(()=>{p()}),{immediate:!0});function f(e){return e.map((e=>e.vm._.exposed.rect.value))}function h(e,t,a){let o=function(e){const t=e.maxLineGap?+e.maxLineGap:e.lineGap;return{align:~["left","right","center"].indexOf(e.align)?e.align:"left",line:~["v","h"].indexOf(e.line)?e.line:"v",lineGap:+e.lineGap,minLineGap:e.minLineGap?+e.minLineGap:e.lineGap,maxLineGap:t,singleMaxWidth:Math.max(e.singleMaxWidth||0,t),fixedHeight:!!e.fixedHeight,grow:e.grow&&e.grow.map((e=>+e))}}(e);("h"===e.line?n:i).calculate(e,o,t,a)}function c(e){!1!==e&&a.autoResize?w(window,"resize",p,!1):x(window,"resize",p,!1)}function p(){clearTimeout(u.value),u.value=setTimeout(s,a.interval)}function m(e){let t=e.target,n=t[d];n&&function(e,t){let n=new RegExp("\\s*\\b"+t+"\\b\\s*","g"),i=v(e,"class").replace(n," ").trim();v(e,"class",i)}(t,n)}function v(e,t,n){if(void 0===n)return e.getAttribute(t)||"";e.setAttribute(t,n)}function g(){return void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend?"webkitTransitionEnd":"transitionend"}function w(e,t,n,i=!1){e.addEventListener(t,n,i)}function x(e,t,n,i=!1){e.removeEventListener(t,n,i)}let y=!0;return e.onMounted((()=>{e.watch(a.autoResize,((e,t)=>{c(e)}),{immediate:!0}),w(l.proxy.$el,g(),m,!0),c(a.autoResize);const t=new MutationObserver((e=>{e.forEach((e=>{y&&(y=!1,s())}))}));o.value&&t.observe(o.value,{childList:!0,subtree:!1,attributes:!1}),e.onUnmounted((()=>t.disconnect()))})),e.onBeforeUnmount((()=>{c(!1),x(l.proxy.$el,g(),m,!0)})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"vue-waterfall",ref_key:"waterfallRef",ref:o},[e.renderSlot(t.$slots,"default",{},void 0,!0)],512))}},[["__scopeId","data-v-606a03dc"]]),Waterfallslot:r({__name:"WaterfallSlot",props:{width:{type:Number,required:!0,validator:e=>e>=0},height:{type:Number,required:!0,validator:e=>e>=0},order:{type:Number,default:0},moveClass:{type:String,default:""}},setup(t,{expose:n}){const i=e.getCurrentInstance(),a=t,o=e.ref(!1),l=e.ref(null),r=e.ref({top:0,left:0,width:0,height:0}),d=e.inject("reflow"),u=()=>{d()};e.watch([()=>a.width,()=>a.height],(()=>{u()}));return e.onMounted((()=>{o.value=!0})),e.onUnmounted((()=>{u()})),n({getMeta:()=>({vm:i.proxy,node:l.value,order:a.order,width:a.width,height:a.height,moveClass:a.moveClass}),rect:r}),(t,n)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",{class:"vue-waterfall-slot",ref_key:"node",ref:l},[e.renderSlot(t.$slots,"default",{},void 0,!0)],512)),[[e.vShow,o.value]])}},[["__scopeId","data-v-2591e18a"]])}}));
